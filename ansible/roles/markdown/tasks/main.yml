---
- name: Checkout vim-markdownfmt
  git:
    repo: https://github.com/moorereason/vim-markdownfmt
    dest: /usr/share/vim/vimfiles/pack/markdown/opt/vim-markdownfmt
    version: b3c3dec8f3cf6ebbac07b0ba53e3c9ac78dff794
- name: Make Alpine 3.6 Community repository available to install go
  lineinfile:
    path: /etc/apk/repositories
    line: https://nl.alpinelinux.org/alpine/v3.6/community
- name: Install go and other prerequistes for markdownfmt
  apk: name=libc-dev,go
- name: Install markdownfmt with `go get`
  command: go get -u github.com/shurcooL/markdownfmt
  environment: { GOPATH: /tmp/go, GOBIN: /usr/local/bin }
  args:
   creates: /usr/local/bin/markdownfmt
- name: Clean up after `go get`
  file: path=/tmp/go state=absent
- name: vim ftplugin directory for markdownfmt settings
  file: path=/usr/share/vim/vimfiles/ftplugin/ state=directory mode=0755
- name: Use vim-markdownfmt to write markdown files
  copy:
    dest: /usr/share/vim/vimfiles/ftplugin/markdown.vim
    content: |
      packadd vim-markdownfmt
      augroup markdownfmt
        autocmd!
        autocmd BufWritePre <buffer> call markdownfmt#Format()
      augroup END
