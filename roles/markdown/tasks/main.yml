---
- name: Checkout vim-markdownfmt
  git:
    repo: https://github.com/moorereason/vim-markdownfmt
    dest: /usr/share/vim/vimfiles/pack/markdown/opt/vim-markdownfmt
    version: b3c3dec8f3cf6ebbac07b0ba53e3c9ac78dff794
- name: Make Alpine 3.6 Community repository available to install go
  lineinfile:
    path: /etc/apk/repositories
    line: "@community {{ mirror }}v3.6/community"
- name: Install go and other prerequistes for markdownfmt
  apk: name=libc-dev,go@community
- name: Install markdownfmt with `go get`
  command: go get -u github.com/shurcooL/markdownfmt
  environment: { GOPATH: /tmp/go, GOBIN: /usr/local/bin }
  args:
   creates: /usr/local/bin/markdownfmt
- name: Clean up after `go get`
  file: path=/tmp/go state=absent
- name: vim ftplugin directory for settings
  file: path=/usr/share/vim/vimfiles/ftplugin/ state=directory mode=0755
- name: Custom vim settings in ftplugin
  copy:
    dest: /usr/share/vim/vimfiles/ftplugin/markdown.vim
    content: |
      setlocal spell tabstop=3 shiftwidth=3
      packadd vim-markdownfmt
      augroup markdownfmt
        autocmd!
        autocmd BufWritePre <buffer> call markdownfmt#Format()
      augroup END
- name: Directory for disabling spell checking of modelines
  file: state=directory path=/usr/share/vim/vimfiles/after/syntax mode=0755
- name: Disable spell checking of HTML coments for modelines
  copy:
    content: >
      syn region htmlCommentPart contained start=+--+ end=+--\s*+
      contains=@htmlPreProc,@NoSpell
    dest: /usr/share/vim/vimfiles/after/syntax/markdown.vim
